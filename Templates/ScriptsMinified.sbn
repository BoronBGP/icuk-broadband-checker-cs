<script>
function populateTable(e,t){let a=document.querySelector(`#broadband-availability-results[broadband-availability-id="${e}"]`);if(!a){console.error("Table with specified broadband availability ID not found");return}let l=a.querySelector("tbody");l.querySelectorAll("tr").forEach(e=>{let t=e.querySelectorAll("td:not(:first-child)");t.forEach(e=>{e.textContent=""})}),t.forEach(e=>{"LLU"==e.technology&&(e.technology="ADSL2");let t=e.technology.replace(/[^\w\s]/gi,""),a=l.querySelector(`#${t}`);if(a){let i=a.querySelector("td:nth-child(2)"),d=a.querySelector("td:nth-child(3)"),r=e.speed_range?e.speed_range:e.likely_down_speed,o=e.speed_range_up?e.speed_range_up:e.likely_up_speed;(!i.textContent||parseFloat(r)>parseFloat(i.textContent))&&(i.textContent=r||""),(!d.textContent||parseFloat(o)>parseFloat(d.textContent))&&(d.textContent=o||"");let n=a.querySelector("td:nth-child(4)"),s=a.querySelector("td:nth-child(5)");e.provider.startsWith("WBC")&&e.availability&&(n.innerHTML='<span id="broadband-availability-available">Available</span>'),"TTB"===e.provider&&e.availability&&(s.innerHTML='<span id="broadband-availability-available">Available</span>')}}),l.querySelectorAll("tr").forEach(e=>{let t=e.querySelector("td:nth-child(2)"),a=e.querySelector("td:nth-child(3)"),l=e.querySelector("td:nth-child(4)"),i=e.querySelector("td:nth-child(5)");t.textContent||(t.textContent="-"),a.textContent||(a.textContent="-"),l.textContent||(l.innerHTML='<span id="broadband-availability-not-available">Not Available</span>'),i.textContent||(i.innerHTML='<span id="broadband-availability-not-available">Not Available</span>')})}function populateAddressList(e,t){let a=document.querySelector('#broadband-availability-address-list[broadband-availability-id="'+e+'"]'),l=a.querySelector("tbody");l.innerHTML="",t.addresses.forEach((t,a)=>{let i=document.createElement("tr"),d=document.createElement("td"),r=document.createElement("input");r.type="radio",r.onclick=function(){sendAddressPos(e,btoa(t))},d.appendChild(r),i.appendChild(d);let o=document.createElement("td");null==t.nad_key&&(t.nad_key=""),o.innerHTML=`
	${formatAddress(t)}
	<input id="broadband-availability-address-pos" value="${btoa(t)}" style="display: none;">
        <span id="broadband-availability-address-nad"> ${t.nad_key}</span>
        `,i.appendChild(o),l.appendChild(i)});let i=document.createElement("tr"),d=document.createElement("td"),r=document.createElement("input");r.type="radio",d.appendChild(r),i.appendChild(d);let o=document.createElement("td");o.innerText="None of the above";let n=document.createElement("input");n.id="broadband-availability-address-pos",n.value="-1",n.style.display="none",o.appendChild(n),i.appendChild(o),l.appendChild(i)}function filterAddressList(e){let t=document.querySelector('#broadband-availability-address-list[broadband-availability-id="'+e+'"]'),a=t.querySelector("#broadband-availability-address-filter"),l=a.value.toLowerCase(),i=document.querySelectorAll("#broadband-availability-address-body tr");i.forEach(e=>{let t=e.querySelector("td:nth-child(2)").textContent.toLowerCase();t.includes(l)||"none of the above"==t?e.style.display="table-row":e.style.display="none"})}function sendAddressPos(e,t){hideAddressList(e),showResults(e),fetch("/api.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"addressdata="+encodeURIComponent(t)}).then(e=>e.json()).then(t=>{populateTable(e,t.products)}).catch(e=>{console.error("Error:",e)})}function formatAddress(e){let t=[];e.premises_name&&t.push(e.premises_name);let a=[];return e.thoroughfare_number&&a.push(e.thoroughfare_number),e.thoroughfare_name&&a.push(e.thoroughfare_name),a.length>0&&t.push(a.join(" ")),e.locality&&t.push(e.locality),e.post_town&&t.push(e.post_town),e.county&&t.push(e.county),e.postcode&&t.push(e.postcode),t.join(", ")}function valid_postcode(e){return e=e.replace(/\s/g,""),/^[A-Z]{1,2}[0-9]{1,2} ?[0-9][A-Z]{2}$/i.test(e)}function showResults(e){let t=document.querySelector(`#broadband-availability-results[broadband-availability-id="${e}"]`),a=t.querySelector("tbody");t.style.display="inline-table",a.querySelectorAll("tr").forEach(e=>{let t=e.querySelectorAll("td:not(:first-child)");t.forEach(e=>{e.innerHTML='<div class="broadband-availability-loader"></div>'})})}function hideResults(e){let t=document.querySelector(`#broadband-availability-results[broadband-availability-id="${e}"]`),a=t.querySelector("tbody");t.style.display="",a.querySelectorAll("tr").forEach(e=>{let t=e.querySelectorAll("td:not(:first-child)");t.forEach(e=>{e.innerHTML=""})})}function showAddressList(e){let t=document.querySelector('#broadband-availability-address-list[broadband-availability-id="'+e+'"]');t.style.display="inline-table"}function hideAddressList(e){let t=document.querySelector('#broadband-availability-address-list[broadband-availability-id="'+e+'"]');t.style.display="none"}function cli_or_postcode(e,t){let a=document.querySelector("div[broadband-availability-id='"+e+"'] input").value,l=document.querySelector("#broadband-availability-search-error"),i=document.querySelector(`table[broadband-availability-id="${e}"]`);i.querySelector("tbody"),l.style.display="none",valid_postcode(a)?hideResults(e):showResults(e),fetch(t,{method:"post",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:"cli_or_postcode="+encodeURIComponent(a)}).then(e=>e.ok?e.json():Promise.reject(e)).then(t=>{void 0!==t.products?populateTable(e,t.products):void 0!==t.addresses?(populateAddressList(e,t),showAddressList(e)):(hideResults(e),l.style.display="inline",console.log("Broadband Availability Checker API: A serverside error occured, this is most likely due to an invalid phone number or postcode.",error))}).catch(t=>{hideResults(e),l.style.display="inline",console.log("Broadband Availability Checker API: A serverside error occured, this is likely due to an error thrown from api.interdns.co.uk.",t)})}
</script>